@{
    ViewData["Title"] = "Dashboard";
    var userName = ViewData["UserName"] as string ?? "User";
}

<div class="dashboard-container">

    <!-- SIDEBAR -->
    <aside class="dashboard-sidebar">
        <h3 class="text-center fw-bold">Dashboard</h3>

        <ul class="sidebar-menu">

            <!-- HOME -->
            <li>
                <a href="#"
                   class="sidebar-link active"
                   data-url="/User/PlanWidgetsPartial">
                    ğŸ  Home
                </a>
            </li>

            <!-- PROFILE -->
            <li>
                <a href="#"
                   class="sidebar-link"
                   data-url="/Profile/SetupPartial">
                    ğŸ‘¤ View Profile
                </a>
            </li>

            <!-- GOAL -->
            <li>
                <a href="#"
                   class="sidebar-link"
                   data-url="/Goals/SelectGoalPartial">
                    ğŸ¯ Edit Goal
                </a>
            </li>

            <!-- PROGRESS -->
            <li>
                <a href="#"
                   class="sidebar-link"
                   data-url="/User/ProgressTrackerPartial">
                    ğŸ“ˆ Progress Tracker
                </a>
            </li>

            <!-- FEEDBACK -->
            <li>
                <a href="#"
                   class="sidebar-link"
                   data-url="/User/FeedbackPartial">
                    ğŸ’¬ Feedback
                </a>
            </li>

            <!-- LOGOUT -->
            <li class="mt-4">
                <form method="post" asp-area="Identity" asp-page="/Account/Logout">
                    <button class="logout-btn w-100">
                        ğŸšª Logout
                    </button>
                </form>
            </li>

        </ul>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="dashboard-main">

        <!-- WELCOME -->
        <div class="dashboard-welcome text-center mb-4">
            <h2 class="fw-bold">@userName</h2>
            <p>Welcome to your dashboard ğŸ‘‹</p>
        </div>

        <!-- DYNAMIC CONTENT -->
        <div id="dashboardContent">
            <p class="text-center">Loading...</p>
        </div>

    </main>
</div>

@section Scripts {
<script>
$(function () {

    // Load Home widgets by default
    loadHomeWidgets();

    // Sidebar navigation
    $(".sidebar-link").on("click", function (e) {
        e.preventDefault();

        $(".sidebar-link").removeClass("active");
        $(this).addClass("active");

        const url = $(this).data("url");
        $("#dashboardContent").html("<p class='text-center'>Loading...</p>");
        $("#dashboardContent").load(url, function() {
            bindPartialActions();
        });
    });

    // Load home widgets
    function loadHomeWidgets() {
        $(".sidebar-link").removeClass("active");
        $(".sidebar-link[data-url='/User/PlanWidgetsPartial']").addClass("active");

        $("#dashboardContent").html("<p class='text-center'>Loading...</p>");
        $("#dashboardContent").load("/User/PlanWidgetsPartial", function() {
            bindPartialActions();
        });
    }

    // Bind actions inside partials
    function bindPartialActions() {
        // Profile Save
        $("#profileForm").off("submit").on("submit", function(e){
            e.preventDefault();
            const data = {
                UserId: $("input[name='UserId']").val(),
                FullName: $("input[name='FullName']").val(),
                Age: parseInt($("input[name='Age']").val()),
                Weight: parseFloat($("input[name='Weight']").val()),
                Height: parseFloat($("input[name='Height']").val()),
                Gender: $("select[name='Gender']").val(),
                GoalType: $("select[name='GoalType']").val()
            };
            $.ajax({
                url:'/Profile/SaveProfile',
                type:'POST',
                contentType:'application/json',
                data: JSON.stringify(data),
                success:function(res){
                    if(res.success){
                        $("#profileMessage").text(res.message).removeClass('text-danger').addClass('text-success');
                        setTimeout(()=>{ loadHomeWidgets(); }, 800);
                    }
                },
                error:function(){
                    $("#profileMessage").text('Error saving profile').addClass('text-danger');
                }
            });
        });
    }

});
</script>
}
