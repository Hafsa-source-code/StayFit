@model string

<div class="card shadow p-4">

    <h2 class="text-center fw-bold mb-3">What is your fitness goal?</h2>
    <p class="text-muted text-center mb-4">
        <b>Choose a goal so we can prepare the perfect plan for you.</b>
    </p>

    <div class="row">

        <div class="col-md-6 mb-3">
            <div class="goal-option border rounded p-4 text-center shadow-sm"
                 data-goal="WeightLoss">
                <h4 class="fw-bold text-danger">Weight Loss</h4>
            </div>
        </div>

        <div class="col-md-6 mb-3">
            <div class="goal-option border rounded p-4 text-center shadow-sm"
                 data-goal="WeightGain">
                <h4 class="fw-bold text-success">Weight Gain</h4>
            </div>
        </div>

    </div>

    <button id="continueGoal" class="btn btn-dark w-100 mt-3">Continue</button>
    <div id="goalMessage" class="text-center mt-3 fw-bold"></div>
</div>

<script>
$(function(){

    let selectedGoal = "@Model"; // pre-select if coming from edit

    // Highlight pre-selected goal
    if(selectedGoal) {
        $(".goal-option").each(function(){
            if($(this).data("goal") === selectedGoal) {
                $(this).addClass("selected");
            }
        });
    }

    // Click on goal card
    $(document).off("click", ".goal-option").on("click", ".goal-option", function(){
        $(".goal-option").removeClass("selected");
        $(this).addClass("selected");
        selectedGoal = $(this).data("goal");
    });

    // Continue button
$(document).off("click", "#continueGoal").on("click", "#continueGoal", function(){
    if(!selectedGoal){
        $("#goalMessage").text("Please select a goal").addClass("text-danger");
        return;
    }

    $.ajax({
        url: "/Goals/SaveGoal",
        type: "POST",
        contentType: "application/json",
        data: JSON.stringify({ Goal: selectedGoal }),
        success: function() {
            // Load plan bundle using your existing LoadGoalPlans endpoint
            $("#dashboardContent")
                .html("<p class='text-center'>Loading your plan...</p>")
                .load("/Plans/LoadGoalPlans", function(){
                    // Bind Save Plan button
                    $("#savePlanBtn").off("click").on("click", function(){
                        $.ajax({
                            url: "/Plans/SaveUserPlan",
                            type: "POST",
                            contentType: "application/json",
                            data: JSON.stringify({ PlanType: selectedGoal }),
                            success: function(){
                                $("#dashboardContent")
                                    .html("<p class='text-center'>Loading plans...</p>")
                                    .load("/User/PlanWidgetsPartial"); // go back to dashboard home
                            },
                            error: function(){
                                $("#planMessage")
                                    .text("Error saving plan")
                                    .addClass("text-danger");
                            }
                        });
                    });

                    // Bind Back button
                    $("#backBtn").off("click").on("click", function(){
                        $("#dashboardContent").load("/Goals/SelectGoalPartial"); // go back to goal selection
                    });
                });
        },
        error: function() {
            $("#goalMessage").text("Error saving goal").addClass("text-danger");
        }
    });
});


});
</script>

<style>
.goal-option {
    cursor: pointer;
    transition: 0.25s ease;
    min-height: 170px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.3rem;
}

/* Hover effect */
.goal-option:hover {
    transform: scale(1.04);
    background-color: #f0f8ff;
}

/* Selected card style */
.goal-option.selected {
    border: 4px solid #0d6efd;
    background-color: #eef5ff;
    transform: scale(1.04);
}
</style>
